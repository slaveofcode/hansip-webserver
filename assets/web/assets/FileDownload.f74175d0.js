import{d as I,z as L,u as A,a as V,O as B,W as y,k as l,aC as M,o as n,b as c,e,a5 as P,aQ as R,x as $,f,n as F,$ as z,g as U,w as Y,m as k,v as S,h as D,p as q,j as E}from"./index.7e98157d.js";import{u as O,_ as Q}from"./Modal.vue_vue_type_script_setup_true_lang.c0c97e9e.js";import{s as N}from"./index.23aca5cf.js";import{_ as T}from"./_plugin-vue_export-helper.cdc0426e.js";const i=r=>(q("data-v-9453c9cc"),r=r(),E(),r),W={class:"container flex flex-col w-full"},G=i(()=>e("h1",{class:"text-3xl mb-3"},"Download the Files",-1)),H={class:"file-list w-full bg-gray-800 flex flex-col justify-center items-start overflow-y-auto"},J={class:"flex flex-col justify-start items-start"},K=i(()=>e("span",{class:"text-green-500 font-bold"},">",-1)),X={class:"ml-1"},Z={class:"flex flex-row justify-center items-center w-full mt-3"},ee=["disabled","onClick"],se=["onSubmit"],te={key:0,class:"form-control textbox"},oe=i(()=>e("span",null,"Download Page Password",-1)),ae={key:1,class:"form-control textbox"},le=i(()=>e("span",null,"Your Account Password",-1)),ne=i(()=>e("div",{class:"flex flex-row justify-end items-center w-full"},[e("button",{type:"submit",class:"block btn btn-orange"},"Show File")],-1)),ce=I({__name:"FileDownload",setup(r){const v=L(),h=A(),_=O(),p=V();p.isAuthenticated||p.validateAuth().catch();const x=B({code:v.params.code,files:[]}),w=y(x,"code"),o=y(x,"files"),m=l(!1),b=l(!1),g=l(!1);M(async()=>{const s=await _.viewFiles(w.value);if(s||h.push({name:"error"}),s.isNeedLogin&&!p.isAuthenticated){h.push({name:"login-account",query:{url:v.fullPath}});return}if(!s.isAllowed){N("You're not allowed to open this file");return}m.value=s.isProtected||s.isNeedLogin,b.value=s.isProtected,g.value=s.isNeedLogin,!s.isProtected&&!s.isNeedLogin&&(o.value=s.files)});const d=l(),u=l(),C=async()=>{const{ok:s,message:a,files:t}=await _.viewProtectedFiles(w.value,{pagePassword:d.value,accountPassword:u.value});if(!s){N(a);return}o.value=t,m.value=!1},j=async()=>{await _.downloadFiles(w.value,{pagePassword:d.value,accountPassword:u.value})};return(s,a)=>(n(),c(P,null,[e("div",W,[G,e("div",H,[e("ul",J,[(n(!0),c(P,null,R(f(o),t=>(n(),c("li",{class:"mb-2",key:t.fileId},[K,e("span",X,$(t.fileName),1)]))),128))])]),e("div",Z,[e("button",{disabled:f(o).length<=0,onClick:F(j,["prevent"]),class:z(["block btn",{"btn-orange":f(o).length>0,"btn-disable":f(o).length<=0}])},"Download",10,ee)])]),U(Q,{show:m.value,"no-close-button":!0},{default:Y(()=>[e("form",{onSubmit:F(C,["prevent"]),class:"flex flex-col justify-start items-start mt-3"},[b.value?(n(),c("label",te,[oe,k(e("input",{type:"password","onUpdate:modelValue":a[0]||(a[0]=t=>d.value=t)},null,512),[[S,d.value]])])):D("",!0),g.value?(n(),c("label",ae,[le,k(e("input",{type:"password","onUpdate:modelValue":a[1]||(a[1]=t=>u.value=t)},null,512),[[S,u.value]])])):D("",!0),ne],40,se)]),_:1},8,["show"])],64))}});const fe=T(ce,[["__scopeId","data-v-9453c9cc"]]);export{fe as default};
